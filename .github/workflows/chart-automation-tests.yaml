name: Charts Validation Tests

on:
  pull_request:
    branches:
      - master
    paths:
      - 'charts/sysdig-deploy/**'
      - 'charts/admission-controller/**'
      - 'charts/node-analyzer/**'
      - 'charts/kspm-collector/**'
      - 'charts/rapid-response/**'

jobs:
  helm-charts-validation-test:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger QA helm-charts-validation tests
        id: helm-charts-validation
        uses: toptal/jenkins-job-trigger-action@master
        with:
          jenkins_url: "https://sysdig-jenkins.internal.sysdig.com"
          jenkins_token: ${{ secrets.TOOLS_JENKINS_ADMIN_ACCESS_GITHUB_TOKEN }}
          job_name: "QA-agent/job/helm-charts-validation/"
          job_params: |
            {
              "HELM_CHART_BRANCH": "${{ github.head_ref }}"
            }
          job_timeout: "43200"
