name: charts-automation tests

on:
  pull_request:
    branches:
      - master
    paths:
      - 'charts/sysdig-deploy/**'
      - 'charts/admission-controller/**'
      - 'charts/node-analyzer/**'
      - 'charts/kspm-collector/**'
      - 'charts/rapid-response/**'

jobs:
  helm-charts-validation-test:
    runs-on: tools-runner
    steps:
      - name: Trigger QA helm-charts-validation tests
        id: helm-charts-validation
        uses: toptal/jenkins-job-trigger-action@master
        with:
          jenkins_url: "https://sysdig-jenkins.internal.sysdig.com"
          jenkins_user: ${{ secrets.JENKINS_USER }}
          jenkins_token: ${{ secrets.JENKINS_API_TOKEN }}
          job_name: "QA-agent/job/helm-charts-validation/"
          job_params: |
            {
              "SLACK_CHANNEL": "#qa-activity-agent"
              "HELM_CHART_BRANCH": "${{ github.head_ref }}",
            }
          job_timeout: "43200"
