suite: Host - GKE Allowlist Waiter Job
templates:
  - templates/host/gke-allowlist-waiter-job.yaml
release:
  name: release-name
  namespace: shield-namespace
values:
  - ../values/gke-autopilot.yaml
tests:
  - it: Contains the GKE Allowlist Waiter Job resource
    asserts:
      - containsDocument:
          kind: Job
          apiVersion: batch/v1
          name: release-name-shield-host-allowlist-waiter
      - equal:
          path: metadata.namespace
          value: shield-namespace
      - equal:
          path: metadata.annotations["helm.sh/hook"]
          value: pre-install,pre-upgrade
      - equal:
          path: metadata.annotations["helm.sh/hook-weight"]
          value: "5"
      - equal:
          path: metadata.annotations["helm.sh/hook-delete-policy"]
          value: before-hook-creation,hook-succeeded
      - equal:
          path: spec.template.spec.serviceAccountName
          value: release-name-shield-host
      - equal:
          path: spec.template.spec.containers[0].name
          value: wait-for-allowlist
