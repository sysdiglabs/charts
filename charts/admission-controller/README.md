<!--


DO NOT MODIFY THIS FILE MANUALLY!!

IT'S AUTO-GENERATED vÃ­a README.tpl with pre-comit plugin
this is under construction so it must be launched manually

in the project root, run:
$ pre-commit install
$ pre-commit run -a

-->

# Chart: Admission Controller

## Overview

Sysdig Admission Controller provides Audit Logging and optional Image Scanning capabilities to secure your Kubernetes environment. 

Use the [sysdig-deploy](../sysdig-deploy/README.md) parent chart to deploy the Admission Controller and any other subcomponents. Do not deploy subcharts directly. 

To deploy the Admission Controller, follow the installation instructions given in  [Install Kubernetes Audit Logging](https://docs.sysdig.com/en/docs/installation/sysdig-secure/install-agent-components/kubernetes/install-kubernetes-audit-logging/).

## Use Cases

### Kubernetes Audit Logging

This chart is primarily responsible for enabling Kubernetes audit logging so that Sysdig Secure can audit the following:

- Creation and destruction of pods, services, deployments, and DaemonSets.
- Creating, updating, and removing ConfigMaps or secrets.
- Attempts at subscribing to the changes to any endpoint.

For deployment instructions, including common deployment configurations related to proxies and certificates, see [Install Kubernetes Audit Logging](https://docs.sysdig.com/en/docs/installation/sysdig-secure/install-agent-components/kubernetes/install-kubernetes-audit-logging/). 

### (Legacy Option) Image Scanning Using Scanning Engine V1

If you use the [Legacy Scanning Engine](https://docs.sysdig.com/en/docs/sysdig-secure/scanning/) instead of the new Vulnerability Management engine in Sysdig Secure, you can deploy the `admission-controller` chart with old scanning options enabled and use [admission controller policies](https://docs.sysdig.com/en/docs/sysdig-secure/scanning/admission-controller/) to reject container images that do not fulfill the policy requirements from the cluster before being scheduled.

This option is enabled by default unless you specify  `--scanner.enabled=false` .

## Verify the Integrity and Origin

Sysdig Helm charts are signed so you can confirm the integrity and origin of each chart. To do so:

1. Import the Public Key:

   ```bash
   $ curl -o "/tmp/sysdig_public.gpg" "https://charts.sysdig.com/public.gpg"
   $ gpg --import /tmp/sysdig_public.gpg
   ```

2. Verify the chart by appending the `--verify` flag to the `install`, `upgrade`, and `pull` helm commands

## Configuration

You can use the Helm chart to update the default Admission Controller configurations by using either of the following:

- Using the key-value pair: `--set sysdig.settings.key = value`
- `values.yaml` file

### Using the Key-Value Pair

Specify each parameter using the `--set key=value[,key=value]` argument to the `helm install`command.

For example:

```bash
$ helm upgrade --install sysdig-admission-controller sysdig/admission-controller \
    --create-namespace -n sysdig-admission-controller --version=0.9.0 \
    --set sysdig.secureAPIToken=YOUR-KEY-HERE,clusterName=YOUR-CLUSTER-NAME
```

### Using values.yaml

The `values.yaml` file specifies the values for the configuration parameters.  You can add the configuration to the `values.yaml` file, then use it in the `helm install` command.

For example:

```bash
$ helm upgrade --install sysdig-admission-controller sysdig/admission-controller \
    --create-namespace -n sysdig-admission-controller --version=0.9.0 \
    --values values.yaml
```

## Configuration Parameters

The following table lists the configurable parameters of the `admission-controller` chart and their default values.

|                     Parameter                      |Feature |                                                                                                                                                                                                                            Description                                                                                                                                                                                                                              |                                                                                              Default                                                                                               |
|----------------------------------------------------|--------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| global.clusterConfig                               | Common | Global cluster config options.                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                                                                                                                                                                    |
| global.sysdig.secureAPIToken                       | Common | Global API token to access Sysdig Secure.                                                                                                                                                                                                                                                                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| global.sysdig.secureAPITokenSecret                 | Common | Global secret with API Token to access Sysdig Secure.                                                                                                                                                                                                                                                                                                                                                                                                               | <code>""</code>                                                                                                                                                                                    |
| global.sysdig.region                               | Common | Global Sysdig Secure region                                                                                                                                                                                                                                                                                                                                                                                                                                         | <code>"us1"</code>                                                                                                                                                                                 |
| global.proxy                                       | Common | Global HTTP Proxy settings.                                                                                                                                                                                                                                                                                                                                                                                                                                         | <code>{}</code>                                                                                                                                                                                    |
| global.image.pullSecrets                           | Common |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>[]</code>                                                                                                                                                                                     |
| global.image.pullPolicy                            | Common |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>IfNotPresent</code>                                                                                                                                                                           |
| clusterName                                        | Common | **required** <br/> Cluster Name which appear on Secure UI                                                                                                                                                                                                                                                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| namespace                                          | Common | Namespace to install components (Optional, will default to release namespace). <br/><br/> IMPORTANT: If a namespace is specified this way it must already exist otherwise installation will fail.                                                                                                                                                                                                                                                                   | <code>""</code>                                                                                                                                                                                    |
| sysdig.secureAPIToken                              | Common | **required** <br/> API Token to access Sysdig Secure. <br/><br/>If neither this value nor `sysdig.existingSecureAPITokenSecret` are configured, the user will be required to provide the deployment of the `SECURE_API_TOKEN` (and `AUTH_BEARER_TOKEN` if the scanner is enabled) environment variables. Overrides `global.sysdig.secureAPIToken`                                                                                                                      | <code>""</code>                                                                                                                                                                                    |
| sysdig.existingSecureAPITokenSecret                | Common | **required** <br/>Existing secret with API Token to access Sysdig Secure <br/>Alternatively, specify the name of a Kubernetes secret containing `SECURE_API_TOKEN` and `AUTH_BEARER_TOKEN` entry if you're also enabling scanner. <br/><br/>If neither this value nor `sysdig.secureAPIToken` are configured, the user will be required to provide the deployment the `SECURE_API_TOKEN` (and `AUTH_BEARER_TOKEN` if the scanner is enabled) environment variables. | <code>""</code>                                                                                                                                                                                    |
| sysdig.apiEndpoint                                 | Common | Sysdig URL.<br/> - Default secure.sysdig.com is for the us-east region.<br/> - For us-west use us2.app.sysdig.com<br/> - For European Union, use eu1.app.sysdig.com<br/> - For APAC, use app.au1.sysdig.com<br/> - For US4 (our west Google cloud region) use app.us4.sysdig.com<br/> - For on-prem, your own enpoints<br/>                                                                                                                                         | <code>""</code>                                                                                                                                                                                    |
| features.k8sAuditDetections                        | Audit  | Enable K8s Audit detections with Falco rules                                                                                                                                                                                                                                                                                                                                                                                                                        | <code>true</code>                                                                                                                                                                                  |
| features.k8sAuditDetectionsRules                   | Audit  | [Admission Webhook Configuration rules](https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#matching-requests-rules) for the Audit Detections                                                                                                                                                                                                                                                                                 | <code>[{"apiGroups":["","apps","autoscaling","batch","networking.k8s.io","rbac.authorization.k8s.io","extensions"],"apiVersions":["*"],"operations":["*"],"resources":["*/*"],"scope":"*"}]</code> |
| verifySSL                                          | Common | For outbound connections (secure backend, proxy,...) <br/>Whether to verify SSL on HTTPS connections                                                                                                                                                                                                                                                                                                                                                                | <code>true</code>                                                                                                                                                                                  |
| nameOverride                                       | Common | Chart name override                                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>""</code>                                                                                                                                                                                    |
| fullnameOverride                                   | Common | Chart full name override                                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>""</code>                                                                                                                                                                                    |
| labels                                             | Common | Additional labels, applies to both scanner and webhook                                                                                                                                                                                                                                                                                                                                                                                                              | <code>{}</code>                                                                                                                                                                                    |
| serviceAccounts.webhook.create                     | Common | Create the service account                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>true</code>                                                                                                                                                                                  |
| serviceAccounts.webhook.annotations                | Common | Extra annotations for serviceAccount                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                                                                                                                                                    |
| serviceAccounts.webhook.name                       | Common | Use this value as serviceAccount Name                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>""</code>                                                                                                                                                                                    |
| serviceAccounts.scanner.create                     | Scanner| Create the service account                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>true</code>                                                                                                                                                                                  |
| serviceAccounts.scanner.annotations                | Scanner| Extra annotations for serviceAccount                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                                                                                                                                                    |
| serviceAccounts.scanner.name                       | Scanner| Use this value as serviceAccount Name                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>""</code>                                                                                                                                                                                    |
| podMonitors.webhook.enabled                        | Common | Enable the webhook PodMonitor to scrape metrics                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>false</code>                                                                                                                                                                                 |
| podMonitors.webhook.labels                         | Common | Labels on the webhook PodMonitor                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                                                                                                                                                    |
| podMonitors.webhook.annotations                    | Common | Annotations on the webhook PodMonitor                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                                                                                                                                                    |
| podMonitors.scanner.enabled                        | Scanner| Enable the scanner PodMonitor to scrape metrics                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>false</code>                                                                                                                                                                                 |
| podMonitors.scanner.labels                         | Scanner| Labels on the scanner PodMonitor                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                                                                                                                                                    |
| podMonitors.scanner.annotations                    | Scanner| Annotations on the scanner PodMonitor                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                                                                                                                                                    |
| webhook.name                                       | Common | Service name for Webhook deployment                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>webhook</code>                                                                                                                                                                               |
| webhook.replicaCount                               | Common | Amount of replicas for webhook. **Deprecated**, use `webhook.autoscaling.minReplicas` and `webhook.autoscaling.maxReplicas` instead.                                                                                                                                                                                                                                                                                                                                | <code>1</code>                                                                                                                                                                                     |
| webhook.image.registry                             | Common | Webhook image registry                                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>quay.io</code>                                                                                                                                                                               |
| webhook.image.repository                           | Common | Webhook image registry                                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>sysdig/admission-controller</code>                                                                                                                                                           |
| webhook.image.pullPolicy                           | Common | PullPolicy for Webhook image                                                                                                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| webhook.image.tag                                  | Common | Override the default image tag. If not specified, it defaults to appVersion in Chart.yaml                                                                                                                                                                                                                                                                                                                                                                           | <code></code>                                                                                                                                                                                      |
| webhook.image.digest                               | Common | Specify the image digest value.  If set, this value is used instead of the tag value.                                                                                                                                                                                                                                                                                                                                                                               | <code></code>                                                                                                                                                                                      |
| webhook.labels                                     | Common | Additional labels, applies to webhook only                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>{}</code>                                                                                                                                                                                    |
| webhook.service.type                               | Common | Use this type as webhook service                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>ClusterIP</code>                                                                                                                                                                             |
| webhook.service.port                               | Common | Configure port for the webhook service                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>443</code>                                                                                                                                                                                   |
| webhook.rbac.create                                | Common | Enable the creation of ClusterRoles and the binding of these roles                                                                                                                                                                                                                                                                                                                                                                                                  | <code>true</code>                                                                                                                                                                                  |
| webhook.httpProxy                                  | Common | HTTP Proxy settings for webhook. <br/>Set to http(s)://proxyIp:proxyPort in case connection to Sysdig Secure requires a proxy                                                                                                                                                                                                                                                                                                                                       | <code>""</code>                                                                                                                                                                                    |
| webhook.httpsProxy                                 | Common | HTTPS Proxy settings for webhook. <br/>Set to http(s)://proxyIp:proxyPort in case connection to Sysdig Secure requires a proxy                                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                                                                                                                                                                    |
| webhook.noProxy                                    | Common | List of hosts, IPs, or IPs in CIDR format that should not go through the proxy. We include "kubernetes" service and typical 10.0.0.0/8 services                                                                                                                                                                                                                                                                                                                     | <code>kubernetes,10.0.0.0/8</code>                                                                                                                                                                 |
| webhook.podAnnotations                             | Common | Webhook pod annotations. If empty, some annotations are automatically generated for Prometheus scraping.                                                                                                                                                                                                                                                                                                                                                            | <code>{}</code>                                                                                                                                                                                    |
| webhook.podSecurityContext                         | Common | Pod Security context for webhook. If empty, some security contexts are automatically generated.                                                                                                                                                                                                                                                                                                                                                                       | <code>{}</code>                                                                                                                                                                                    |
| webhook.securityContext                            | Common | Configure securityContext for webhook. If empty, some security contexts are automatically generated.                                                                                                                                                                                                                                                                                                                                                                 | <code>{}</code>                                                                                                                                                                                    |
| webhook.hostNetwork                                | Common | Specifies if the webhook should be started in hostNetwork mode. <br/>This is required if using a custom CNI where the managed control plane nodes are unable to initiate network connections to the pods, for example using the Calico CNI plugin on EKS. <br/>This is not required or recommended in most contexts.                                                                                                                                                    | <code>false</code>                                                                                                                                                                                 |
| webhook.imagePullSecrets                           | Common | The image pull secrets for webhook                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>[]</code>                                                                                                                                                                                    |
| webhook.resources                                  | Common | Resource request and limits for webhook                                                                                                                                                                                                                                                                                                                                                                                                                             | <code>{"limits":{"cpu":"250m","memory":"256Mi"},"requests":{"cpu":"100m","memory":"256Mi"}}</code>                                                                                                 |
| webhook.autoscaling.minReplicas                    | Common | Min replicas to use while autoscaling the webhook                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>2</code>                                                                                                                                                                                     |
| webhook.autoscaling.maxReplicas                    | Common | Max replicas to use while autoscaling the webhook                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>5</code>                                                                                                                                                                                     |
| webhook.autoscaling.targetCPUUtilizationPercentage | Common | Target CPU to use when the number of replicas must be increased                                                                                                                                                                                                                                                                                                                                                                                                     | <code>80</code>                                                                                                                                                                                    |
| webhook.timeoutSeconds                             | Common | Number of seconds for the request to time out                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>5</code>                                                                                                                                                                                     |
| webhook.nodeSelector                               | Common | Configure nodeSelector for scheduling for webhook                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>{}</code>                                                                                                                                                                                    |
| webhook.priorityClassName                          | Common | priorityClassName config for the webhook                                                                                                                                                                                                                                                                                                                                                                                                                            | <code></code>                                                                                                                                                                                      |
| webhook.tolerations                                | Common | Tolerations for scheduling for webhook                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>[]</code>                                                                                                                                                                                    |
| webhook.affinity                                   | Common | Configure affinity rules for webhook                                                                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                                                                                                                                                    |
| webhook.denyOnError                                | Common | Deny request when an error happened evaluating request                                                                                                                                                                                                                                                                                                                                                                                                              | <code>false</code>                                                                                                                                                                                 |
| webhook.dryRun                                     | Common | Dry Run request                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>false</code>                                                                                                                                                                                 |
| webhook.logLevel                                   | Common | Log Level - Valid Values are: error, info, debug, trace                                                                                                                                                                                                                                                                                                                                                                                                             | <code>info</code>                                                                                                                                                                                  |
| webhook.ssl.reuseTLSSecret                         | Common | Reuse existing TLS Secret during chart upgrade                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                                                                                                                                                                 |
| webhook.ssl.ca.cert                                | Common | For outbound connections (secure backend, proxy,...) <br/>And inbound connections to serve HttpRequests as Kubernetes Webhook. <br/>A PEM-encoded x509 certificate authority. <br/>If empty, a new CA will be autogenerated.                                                                                                                                                                                                                                        | <code>""</code>                                                                                                                                                                                    |
| webhook.ssl.ca.key                                 | Common | For outbound connections (secure backend, proxy,...) <br/>A PEM-encoded private key of the certificate authority to use in the certificate generation. <br/>If empty, a new CA will be autogenerated.                                                                                                                                                                                                                                                               | <code>""</code>                                                                                                                                                                                    |
| webhook.ssl.cert                                   | Common | For inbound connections to serve HttpRequests as Kubernetes Webhook. <br/>A PEM-encoded x509 certificate signed by the CA. <br/>If empty, a new cert will be generated. <br/>If provided, it must be valid with the `webhook.ssl.ca`. <br/>If this is set, the key must also be provided.                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| webhook.ssl.key                                    | Common | For inbound connections to serve HttpRequests as Kubernetes Webhook. <br/>A PEM-encoded private key signed by the CA. <br/>If empty, a new key will be generated. <br/>If provided, it must be valid with the `webhook.ssl.ca`. <br/>If this is set, the cert must also be provided.                                                                                                                                                                                | <code>""</code>                                                                                                                                                                                    |
| webhook.customEntryPoint                           | Common | Custom entrypoint for the webhook <br/>Remember to provide the webhook valid arguments with `--tls_cert_file` and `--tls_private_key_file`. <br/>default: /bin/webhook --tls_cert_file /cert/tls.crt --tls_private_key_file /cert/tls.key                                                                                                                                                                                                                           | <code>[]</code>                                                                                                                                                                                    |
| webhook.http.port                                  | Common | HTTP serve port where the requests will be served from                                                                                                                                                                                                                                                                                                                                                                                                              | <code>5000</code>                                                                                                                                                                                  |
| scc.create                                         | Common | Enable the creation of Security Context Constraints in Openshift                                                                                                                                                                                                                                                                                                                                                                                                    | <code>true</code>                                                                                                                                                                                  |
| scanner.enabled                                    | Common | If you only want the Kubernetes Audit Log functionality then disable this, and it will disable the Admission Controller Scanning Policy functionality.                                                                                                                                                                                                                                                                                                              | <code>true</code>                                                                                                                                                                                  |
| scanner.name                                       | Scanner| Service name for Scanner deployment                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>scanner</code>                                                                                                                                                                               |
| scanner.replicaCount                               | Scanner| Amount of replicas for scanner                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>1</code>                                                                                                                                                                                     |
| scanner.image.registry                             | Scanner| Scanner image registry                                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>quay.io</code>                                                                                                                                                                               |
| scanner.image.repository                           | Scanner| Scanner image repository                                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>sysdig/inline-scan-service</code>                                                                                                                                                            |
| scanner.image.pullPolicy                           | Scanner| PullPolicy for Scanner image                                                                                                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| scanner.image.tag                                  | Scanner| Scanner image tag                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>0.0.13</code>                                                                                                                                                                                |
| scanner.image.digest                               | Scanner| Specify the image digest value.  If set, this value is used instead of the tag value.                                                                                                                                                                                                                                                                                                                                                                               | <code></code>                                                                                                                                                                                      |
| scanner.labels                                     | Scanner| Additional labels, applies to scanner only                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>{}</code>                                                                                                                                                                                    |
| scanner.service.port                               | Scanner| Configure port for the webhook service                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>8080</code>                                                                                                                                                                                  |
| scanner.authWithSecureToken                        | Scanner| Authenticate with Secure token                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                                                                                                                                                                 |
| scanner.httpProxy                                  | Scanner| HTTP Proxy settings for scanner. <br/>Set to http(s)://proxyIp:proxyPort in case connection to Sysdig Secure requires a proxy                                                                                                                                                                                                                                                                                                                                       | <code>""</code>                                                                                                                                                                                    |
| scanner.httpsProxy                                 | Scanner| HTTPS Proxy settings for scanner. <br/>Set to http(s)://proxyIp:proxyPort in case connection to Sysdig Secure requires a proxy                                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                                                                                                                                                                    |
| scanner.noProxy                                    | Scanner| List of hosts, IPs, or IPs in CIDR format that should not go through the proxy. We include "kubernetes" service and typical 10.0.0.0/8 services                                                                                                                                                                                                                                                                                                                     | <code>kubernetes,10.0.0.0/8</code>                                                                                                                                                                 |
| scanner.podAnnotations                             | Scanner| Scanner pod annotations                                                                                                                                                                                                                                                                                                                                                                                                                                             | <code>{"prometheus.io/path":"/metrics","prometheus.io/port":"8080","prometheus.io/scrape":"true"}</code>                                                                                           |
| scanner.psp.create                                 | Scanner| Whether to create a psp policy and role / role-binding                                                                                                                                                                                                                                                                                                                                                                                                              | <code>false</code>                                                                                                                                                                                 |
| scanner.podSecurityContext                         | Scanner| PSP's for scanner                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>{}</code>                                                                                                                                                                                    |
| scanner.verifyRegistryTLS                          | Scanner| Verify TLS on image pull from registries                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>true</code>                                                                                                                                                                                  |
| scanner.dockerCfgSecretName                        | Scanner| Docker config secret. Use a provided secret containing a .dockercfg for registry authentication (i.e. Openshift internal registry)                                                                                                                                                                                                                                                                                                                                  | <code>""</code>                                                                                                                                                                                    |
| scanner.securityContext                            | Scanner| Configure securityContext for scanner                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{"capabilities":{"drop":["ALL"]},"readOnlyRootFilesystem":true,"runAsNonRoot":true}</code>                                                                                                   |
| scanner.imagePullSecrets                           | Scanner| The image pull secrets for scanner                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>[]</code>                                                                                                                                                                                    |
| scanner.resources                                  | Scanner| Resource requests and limits for scanner                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>{}</code>                                                                                                                                                                                    |
| scanner.nodeSelector                               | Scanner| Configure nodeSelector for scheduling for the scanner                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                                                                                                                                                    |
| scanner.priorityClassName                          | Scanner| priorityClassName config for the scanner                                                                                                                                                                                                                                                                                                                                                                                                                            | <code></code>                                                                                                                                                                                      |
| scanner.tolerations                                | Scanner| Tolerations for scheduling for the scanner                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>[]</code>                                                                                                                                                                                    |
| scanner.affinity                                   | Scanner| Configure affinity rules for the scanner                                                                                                                                                                                                                                                                                                                                                                                                                            | <code>{}</code>                                                                                                                                                                                    |
| scanner.ssl.ca.cert                                | Scanner| For outbound connections (secure backend, proxy,...). <br/>A PEM-encoded x509 certificate authority. <br/>If empty, a new CA will be autogenerated.                                                                                                                                                                                                                                                                                                                 | <code>""</code>                                                                                                                                                                                    |
| scanner.customEntryPoint                           | Scanner| Custom entrypoint for the scanner. <br/>Remember to provide the scanner valid arguments with `--server_port` and optionally `--auth_secure_token` <br/>default: /inline-scan-service --server_port=8080                                                                                                                                                                                                                                                             | <code>[]</code>                                                                                                                                                                                    |


## Examples
- [Default `values.yaml`](https://github.com/sysdiglabs/charts/blob/master/charts/admission-controller/values.yaml)
- Find some [examples of these values](https://github.com/sysdiglabs/charts/tree/master/charts/admission-controller/ci)


## Security Settings

### Proxy Usage

There are several configuration parameters for the proxy usage

- Two involved components `webhook.*` and `scanner.*`; reference to the first for communications to the Sysdig backend, while
second communicates with the registry from where to pull the image to be scanned.
- configuration values `*.httpProxy`, `*.httpsProxy` and `*.noProxy`. Make sure to use at least `https` version for Sysdig Secure Backend.

If your Proxy is served with TLS
- The url for those `*.httpProxy` and `*.httpsProxy` must be `https://`
- If using a self-signed certificate you will need to also configure one of the following two options
    1. Set the `verifySSL=false` parameter
    2. Or set `*.ssl.ca.cert` for both components `webhook` and `scanner`

### On-Prem Settings

Sysdig On-Prem installations might use a TLS self-signed server certificate or one from an untrusted CA, so it requires an extra configuration.

#### Ignore TLS certificate verification

Use the following command to deploy in an on-prem and ignore the untrusted certificate using `verifySSL=false`:

```
$ helm upgrade --install sysdig-admission-controller sysdig/admission-controller \
      --create-namespace -n sysdig-admission-controller \
      --set clusterName=CLUSTER_NAME \
      --set sysdig.secureAPIToken=SECURE_API_TOKEN \
      --set verifySSL=false
```

#### Custom CA Provided

The following command will deploy the admission controller with a custom CA. The custom CA certificate is added to the trusted certificates store.

```
$ helm upgrade --install sysdig-admission-controller sysdig/admission-controller \
      --create-namespace -n sysdig-admission-controller \
      --set clusterName=CLUSTER_NAME \
      --set sysdig.secureAPIToken=SECURE_API_TOKEN \
      --set webhook.ssl.ca.cert=YOUR_CA_CERT_AS_PEM_ENCODED \
      --set scanner.ssl.ca.cert=YOUR_CA_CERT_AS_PEM_ENCODED
```



<!--
Q: Helm v2 usage
should work with minor changes
1. Removed the option "--create-namespace" since not supported in v2. I don't see particular problem in creating the namespace manually before the execution of the chart
2. Added "--name" since required by v2 to specify the chart name
3. Changed Chart.yaml apiVersion: from v2 to v1. It seems that the difference is only related to dependencies and types, and I didn't find any of those in the chart (by default chats are considered as apps)
-->
