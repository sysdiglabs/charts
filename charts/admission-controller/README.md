<!--
TODO: Correct content is now in README.md, being refactories. We will copy back to README.tpl once finished

DO NOT MODIFY README.md MANUALLY!! CHANGE README.tpl instead!!

README.md IS AUTO-GENERATED vÃ­a README.tpl with pre-comit plugin
this is under construction so it must be launched manually

in the project root, run:
$ pre-commit install
$ pre-commit run -a

-->


# Admission Controller

This chart deploys the Sysdig Admission Controller on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Overview

[Sysdig Admission Controller](https://docs.sysdig.com/en/docs/installation/sysdig-secure/install-agent-components/kubernetes/install-kubernetes-audit-logging/) provides Audit Logging and optional Image Scanning capabilities to secure your Kubernetes environment.

Use the [sysdig-deploy](../sysdig-deploy/README.md) parent chart to deploy the Admission Controller and any other subcomponents. Do not deploy subcharts directly.

To deploy the Admission Controller, follow the installation instructions given in  [Install Kubernetes Audit Logging](https://docs.sysdig.com/en/docs/installation/sysdig-secure/install-agent-components/kubernetes/install-kubernetes-audit-logging/).

## Use Cases

### Kubernetes Audit Logging

This chart is primarily responsible for enabling Kubernetes audit logging so that Sysdig Secure can audit the following:

- Creation and destruction of pods, services, deployments, and DaemonSets.
- Creating, updating, and removing ConfigMaps or secrets.
- Attempts at subscribing to the changes to any endpoint.

For deployment instructions, including common deployment configurations related to proxies and certificates, see [Install Kubernetes Audit Logging](https://docs.sysdig.com/en/docs/installation/sysdig-secure/install-agent-components/kubernetes/install-kubernetes-audit-logging/).

### (Legacy Option) Image Scanning Using Scanning Engine V1

If you use the [Legacy Scanning Engine](https://docs.sysdig.com/en/docs/sysdig-secure/scanning/) instead of the new Vulnerability Management engine in Sysdig Secure, you can [deploy the `admission-controller` chart](https://docs.sysdig.com/en/docs/sysdig-secure/scanning/admission-controller/#installation) with old scanning options enabled and use [admission controller policies](https://docs.sysdig.com/en/docs/sysdig-secure/scanning/admission-controller/#create-admission-controller-policies) to reject container images that do not fulfill the policy requirements from the cluster before being scheduled.

This option is enabled by default unless you specify  `--scanner.enabled=false` .


## Verify the Integrity and Origin

Sysdig Helm charts are signed so you can confirm the integrity and origin of each chart. To do so:

1. Import the Public Key:

   ```bash
   $ curl -o "/tmp/sysdig_public.gpg" "https://charts.sysdig.com/public.gpg"
   $ gpg --import /tmp/sysdig_public.gpg
   ```

2. Verify the chart by appending the `--verify` flag to the `install`, `upgrade`, and `pull` helm commands.


## Configuration

### Using the Key-Value Pair

Specify each parameter using the `--set key=value[,key=value]` argument to the `helm install`command.

For example:

```bash
helm upgrade --install admission-controller sysdig/admission-controller \
    --create-namespace -n sysdig-admission-controller --version=0.16.2  \
    --set sysdig.secureAPIToken=YOUR-KEY-HERE,clusterName=YOUR-CLUSTER-NAME
```

### Using values.yaml

The `values.yaml` file specifies the values for the admission controller configuration parameters.  You can add the configuration to the `values.yaml` file, then use it in the `helm install` command.

For example:

```bash
helm upgrade --install admission-controller sysdig/admission-controller \
     --create-namespace -n sysdig-admission-controller --version=0.16.2  \
    --values values.yaml

```

See the default [`values.yaml`](./values.yaml) file for more information.


## Configuration Parameters

The following table lists the configurable parameters of the `admission-controller` chart and their default values.

|                     Parameter                      |                                                                                                                                                                                                                          Description                                                                                                                                                                                                                          |                                                                                              Default                                                                                               |
|----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| global.clusterConfig                               | The global cluster configuration options.                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                                                                                                                                                    |
| global.sysdig.secureAPIToken                       | The global API token to access Sysdig Secure.                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>""</code>                                                                                                                                                                                    |
| global.sysdig.secureAPITokenSecret                 | The global secret with API Token to access Sysdig Secure.                                                                                                                                                                                                                                                                                                                                                                                                     | <code>""</code>                                                                                                                                                                                    |
| global.sysdig.region                               | The global Sysdig Secure region.                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>"us1"</code>                                                                                                                                                                                 |
| global.sysdig.accessKey                            | The global Access Key to access Sysdig Secure.                                                                                                                                                                                                                                                                                                                                                                                                                | <code>""</code>                                                                                                                                                                                    |
| global.proxy                                       | Global HTTP Proxy settings.                                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>{}</code>                                                                                                                                                                                    |
| global.image.pullSecrets                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>[]</code>                                                                                                                                                                                    |
| global.image.pullPolicy                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>IfNotPresent</code>                                                                                                                                                                          |
| global.ssl.ca.certs                                | For outbound connections (secure backend, proxy,...) A PEM-encoded x509 certificate.  This can also be a bundle with multiple certificates.                                                                                                                                                                                                                                                                                                                   | <code>[]</code>                                                                                                                                                                                    |
| global.ssl.ca.keyName                              | Filename that is used when creating the secret.  Required if cert is provided.                                                                                                                                                                                                                                                                                                                                                                                | <code></code>                                                                                                                                                                                      |
| global.ssl.ca.existingCaSecret                     | Provide the name of an existing Secret that contains the CA required                                                                                                                                                                                                                                                                                                                                                                                          | <code></code>                                                                                                                                                                                      |
| global.ssl.ca.existingCaSecretKeyName              | Provide the filename that is defined inside the existing Secret.  Required if existingCaSecret is set.                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| global.ssl.ca.existingCaConfigMap                  | Provide the name of an existing ConfigMap that contains the CA required                                                                                                                                                                                                                                                                                                                                                                                       | <code></code>                                                                                                                                                                                      |
| global.ssl.ca.existingCaConfigMapKeyName           | Provide the filename that is defined inside the existing ConfigMap.  Required if existingCaConfigMap is set.                                                                                                                                                                                                                                                                                                                                                  | <code></code>                                                                                                                                                                                      |
| clusterName                                        | **required** <br/> The cluster Name which appear on Secure UI                                                                                                                                                                                                                                                                                                                                                                                                 | <code>""</code>                                                                                                                                                                                    |
| namespace                                          | The namespace to install components. An optional field. If not specified, it will default to the release namespace. <br/>IMPORTANT: Ensure that a namespace is already exist, otherwise installation will fail.                                                                                                                                                                                                                                               | <code>""</code>                                                                                                                                                                                    |
| sysdig.secureAPIToken                              | **required** <br/> The API Token to access Sysdig Secure. <br/><br/>If neither this value nor `sysdig.existingSecureAPITokenSecret` is configured, you are required to provide the deployment with the `SECURE_API_TOKEN` (and `AUTH_BEARER_TOKEN` if the scanner is enabled) environment variable. Overrides the `global.sysdig.secureAPIToken` parameter.                                                                                                   | <code>""</code>                                                                                                                                                                                    |
| sysdig.existingSecureAPITokenSecret                | **required** <br/>The existing secret with API Token to access Sysdig Secure. <br/>Alternatively, specify the name of a Kubernetes secret containing `SECURE_API_TOKEN` and `AUTH_BEARER_TOKEN` entry if you're also enabling scanner. <br/>If neither this value nor `sysdig.secureAPIToken` is configured, you are required to provide the deployment with the `SECURE_API_TOKEN` (and `AUTH_BEARER_TOKEN` if the scanner is enabled) environment variable. | <code>""</code>                                                                                                                                                                                    |
| sysdig.accessKey                                   | **required for KSPM Admission Controller** <br/>Access Key to access Sysdig Secure. <br/><br/>Either this value or `sysdig.existingAccessKeySecret` is required Overrides `global.sysdig.accessKey`                                                                                                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| sysdig.existingAccessKeySecret                     | Alternatively, specify the name of a Kubernetes secret containing an 'access-key' entry. Overrides `global.sysdig.existingAccessKeySecret`                                                                                                                                                                                                                                                                                                                    | <code>""</code>                                                                                                                                                                                    |
| sysdig.apiEndpoint                                 | Sysdig URL.<br/> - The default for the us-east region is secure.sysdig.com.<br/> - For us-west use us2.app.sysdig.com<br/> - For European Union, use eu1.app.sysdig.com<br/> - For APAC, use app.au1.sysdig.com<br/> - For US4 (our west Google cloud region) use app.us4.sysdig.com<br/> - For on-prem, your own enpoints<br/>                                                                                                                               | <code>""</code>                                                                                                                                                                                    |
| features.k8sAuditDetections                        | Enable Kubernetes Audit detections with Falco rules.                                                                                                                                                                                                                                                                                                                                                                                                          | <code>true</code>                                                                                                                                                                                  |
| features.kspmAdmissionController                   | Enable KSPM Admission Controller                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>false</code>                                                                                                                                                                                 |
| features.k8sAuditDetectionsRules                   | [Admission Webhook Configuration rules](https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#matching-requests-rules) for the Audit Detections                                                                                                                                                                                                                                                                           | <code>[{"apiGroups":["","apps","autoscaling","batch","networking.k8s.io","rbac.authorization.k8s.io","extensions"],"apiVersions":["*"],"operations":["*"],"resources":["*/*"],"scope":"*"}]</code> |
| verifySSL                                          | Used for outbound connections, such as Secure backend and proxy. <br/>Specifies whether to verify SSL on HTTPS connections.                                                                                                                                                                                                                                                                                                                                   | <code>true</code>                                                                                                                                                                                  |
| nameOverride                                       | The chart name override.                                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                                                                                                                                                                    |
| fullnameOverride                                   | The chart full name override.                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>""</code>                                                                                                                                                                                    |
| labels                                             | Additional labels. It applies to both scanner and webhook.                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                                                                                                                                                    |
| serviceAccounts.webhook.create                     | Creates the service account.                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>true</code>                                                                                                                                                                                  |
| serviceAccounts.webhook.annotations                | The additional annotations for serviceAccount.                                                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                                                                                                                                                    |
| serviceAccounts.webhook.name                       | Use this value as serviceAccount Name.                                                                                                                                                                                                                                                                                                                                                                                                                        | <code>""</code>                                                                                                                                                                                    |
| serviceAccounts.scanner.create                     | Creates the service account.                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>true</code>                                                                                                                                                                                  |
| serviceAccounts.scanner.annotations                | The additional annotations for serviceAccount.                                                                                                                                                                                                                                                                                                                                                                                                                | <code>{}</code>                                                                                                                                                                                    |
| serviceAccounts.scanner.name                       | Use this value as serviceAccount Name.                                                                                                                                                                                                                                                                                                                                                                                                                        | <code>""</code>                                                                                                                                                                                    |
| podMonitors.webhook.enabled                        | Enable the webhook PodMonitor to scrape metrics.                                                                                                                                                                                                                                                                                                                                                                                                              | <code>false</code>                                                                                                                                                                                 |
| podMonitors.webhook.labels                         | Specifies the labels on the webhook PodMonitor.                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                                                                                                                                                    |
| podMonitors.webhook.annotations                    | The annotations on the webhook PodMonitor.                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>{}</code>                                                                                                                                                                                    |
| podMonitors.scanner.enabled                        | Enable the scanner PodMonitor to scrape metrics.                                                                                                                                                                                                                                                                                                                                                                                                              | <code>false</code>                                                                                                                                                                                 |
| podMonitors.scanner.labels                         | Specifies the labels on the scanner PodMonitor.                                                                                                                                                                                                                                                                                                                                                                                                               | <code>{}</code>                                                                                                                                                                                    |
| podMonitors.scanner.annotations                    | The annotatons on the scanner PodMonitor                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                                                                                                                                                                    |
| webhook.v2.nats.insecure                           | Allow insecure TLS certificates in backend connection to NATS service                                                                                                                                                                                                                                                                                                                                                                                         | <code>false</code>                                                                                                                                                                                 |
| webhook.v2.nats.url                                | Override the NATS service connection URL                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                                                                                                                                                                    |
| webhook.v2.service.type                            | Use this type as webhook service                                                                                                                                                                                                                                                                                                                                                                                                                              | <code>ClusterIP</code>                                                                                                                                                                             |
| webhook.v2.service.port                            | Configure port for the V2 webhook service                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>6443</code>                                                                                                                                                                                  |
| webhook.v2.http.port                               | HTTP serve port where the requests will be served from                                                                                                                                                                                                                                                                                                                                                                                                        | <code>6443</code>                                                                                                                                                                                  |
| webhook.v2.image.registry                          | The KSPM Admission Controller image registry                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>quay.io</code>                                                                                                                                                                               |
| webhook.v2.image.repository                        | The KSPM Admission Controller image repository                                                                                                                                                                                                                                                                                                                                                                                                                | <code>sysdig/secure-admission-controller</code>                                                                                                                                                    |
| webhook.v2.image.tag                               | The KSPM Admission Controller image tag                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>1.27.3</code>                                                                                                                                                                                |
| webhook.v2.image.digest                            | Specifies the image digest value.  If set, this value is used instead of the tag value                                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| webhook.v2.image.pullPolicy                        | The PullPolicy for KSPM Admission Controller image                                                                                                                                                                                                                                                                                                                                                                                                            | <code></code>                                                                                                                                                                                      |
| webhook.name                                       | The service name for Webhook deployment                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>webhook</code>                                                                                                                                                                               |
| webhook.vm.enabled                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>false</code>                                                                                                                                                                                 |
| webhook.replicaCount                               | The number of replicas for webhook. **Deprecated**, use `webhook.autoscaling.minReplicas` and `webhook.autoscaling.maxReplicas` instead.                                                                                                                                                                                                                                                                                                                      | <code>1</code>                                                                                                                                                                                     |
| webhook.image.registry                             | The webhook image registry                                                                                                                                                                                                                                                                                                                                                                                                                                    | <code>quay.io</code>                                                                                                                                                                               |
| webhook.image.repository                           | The webhook image repository                                                                                                                                                                                                                                                                                                                                                                                                                                  | <code>sysdig/admission-controller</code>                                                                                                                                                           |
| webhook.image.pullPolicy                           | The PullPolicy for Webhook image                                                                                                                                                                                                                                                                                                                                                                                                                              | <code></code>                                                                                                                                                                                      |
| webhook.image.tag                                  | Overrides the default image tag. If not specified, it defaults to appVersion in Chart.yaml                                                                                                                                                                                                                                                                                                                                                                    | <code></code>                                                                                                                                                                                      |
| webhook.image.digest                               | Specifies the image digest value.  If set, this value is used instead of the tag value                                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| webhook.labels                                     | Specifies the additional labels; applies to webhook only.                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                                                                                                                                                    |
| webhook.service.type                               | Use this type as webhook service.                                                                                                                                                                                                                                                                                                                                                                                                                             | <code>ClusterIP</code>                                                                                                                                                                             |
| webhook.service.port                               | Configure port for the webhook service.                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>443</code>                                                                                                                                                                                   |
| webhook.rbac.create                                | Enable the creation of ClusterRoles and the binding of these roles.                                                                                                                                                                                                                                                                                                                                                                                           | <code>true</code>                                                                                                                                                                                  |
| webhook.httpProxy                                  | The HTTP Proxy settings for webhook. <br/>Set to http(s)://proxyIp:proxyPort if the connections to Sysdig Secure requires a proxy.                                                                                                                                                                                                                                                                                                                            | <code>""</code>                                                                                                                                                                                    |
| webhook.httpsProxy                                 | The HTTPS Proxy settings for webhook. <br/>Set to http(s)://proxyIp:proxyPort if the  connection to Sysdig Secure requires a proxy.                                                                                                                                                                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| webhook.noProxy                                    | List of hosts, IPs, or IPs in CIDR format that should not go through the proxy. Sysdig includes "kubernetes" service and typical 10.0.0.0/8 services.                                                                                                                                                                                                                                                                                                         | <code>kubernetes,10.0.0.0/8</code>                                                                                                                                                                 |
| webhook.podAnnotations                             | The webhook pod annotations. If empty, some annotations are automatically generated for prometheus scraping.                                                                                                                                                                                                                                                                                                                                                  | <code>{}</code>                                                                                                                                                                                    |
| webhook.podSecurityContext                         | The Pod Security context for webhook.If empty, some security context are automatically generated.                                                                                                                                                                                                                                                                                                                                                             | <code>{}</code>                                                                                                                                                                                    |
| webhook.securityContext                            | Configure securityContext for webhook. If empty, some security context are automatically generated.                                                                                                                                                                                                                                                                                                                                                           | <code>{}</code>                                                                                                                                                                                    |
| webhook.hostNetwork                                | Specifies if the webhook should be started in hostNetwork mode. <br/>This field is required if you are using a custom CNI where the managed control plane nodes are unable to initiate network connections to the pods, for example, using Calico CNI plugin on EKS. <br/>This is not required or recommended in most contexts.                                                                                                                               | <code>false</code>                                                                                                                                                                                 |
| webhook.imagePullSecrets                           | The image pull secrets for webhook.                                                                                                                                                                                                                                                                                                                                                                                                                           | <code>[]</code>                                                                                                                                                                                    |
| webhook.resources                                  | Resource request and limits for webhook.                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>{"limits":{"cpu":"250m","memory":"256Mi"},"requests":{"cpu":"100m","memory":"256Mi"}}</code>                                                                                                 |
| webhook.autoscaling.minReplicas                    | The minimum replicas to use while autoscaling the webhook.                                                                                                                                                                                                                                                                                                                                                                                                    | <code>2</code>                                                                                                                                                                                     |
| webhook.autoscaling.maxReplicas                    | The maximum replicas to use while autoscaling the webhook.                                                                                                                                                                                                                                                                                                                                                                                                    | <code>5</code>                                                                                                                                                                                     |
| webhook.autoscaling.targetCPUUtilizationPercentage | The target CPU to use when the number of replicas must be increased.                                                                                                                                                                                                                                                                                                                                                                                          | <code>80</code>                                                                                                                                                                                    |
| webhook.timeoutSeconds                             | The number of seconds for the request to time out.                                                                                                                                                                                                                                                                                                                                                                                                            | <code>5</code>                                                                                                                                                                                     |
| webhook.nodeSelector                               | Configure nodeSelector for scheduling for webhook.                                                                                                                                                                                                                                                                                                                                                                                                            | <code>{}</code>                                                                                                                                                                                    |
| webhook.priorityClassName                          | The priorityClassName configuration for the webhook.                                                                                                                                                                                                                                                                                                                                                                                                          | <code></code>                                                                                                                                                                                      |
| webhook.tolerations                                | Tolerations for scheduling for webhook.                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>[]</code>                                                                                                                                                                                    |
| webhook.affinity                                   | Configure affinity rules for webhook.                                                                                                                                                                                                                                                                                                                                                                                                                         | <code>{}</code>                                                                                                                                                                                    |
| webhook.denyOnError                                | Deny request when an error happened evaluating request.                                                                                                                                                                                                                                                                                                                                                                                                       | <code>false</code>                                                                                                                                                                                 |
| webhook.dryRun                                     | Dry Run request                                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>false</code>                                                                                                                                                                                 |
| webhook.logLevel                                   | Specifies the log level. The valid values are error, info, debug, trace.                                                                                                                                                                                                                                                                                                                                                                                      | <code>info</code>                                                                                                                                                                                  |
| webhook.ssl.reuseTLSSecret                         | Reuse existing TLS Secret during chart upgrade.                                                                                                                                                                                                                                                                                                                                                                                                               | <code>false</code>                                                                                                                                                                                 |
| webhook.ssl.ca.cert                                | Used for outbound connections, such as Secure backend and proxy. <br/>Used also for inbound connections to serve HttpRequests as Kubernetes Webhook. <br/>A PEM-encoded x509 certificate authority.                                                                                                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| webhook.ssl.ca.certs                               | For outbound connections (secure backend, proxy,...) A PEM-encoded x509 certificate.  This can also be a bundle with multiple certificates.                                                                                                                                                                                                                                                                                                                   | <code>[]</code>                                                                                                                                                                                    |
| webhook.ssl.ca.keyName                             | Filename that is used when creating the secret. Required if cert is provided.                                                                                                                                                                                                                                                                                                                                                                                 | <code></code>                                                                                                                                                                                      |
| webhook.ssl.ca.existingCaSecret                    | Provide the name of an existing Secret that contains the CA required                                                                                                                                                                                                                                                                                                                                                                                          | <code></code>                                                                                                                                                                                      |
| webhook.ssl.ca.existingCaSecretKeyName             | Provide the filename that is defined inside the existing Secret.  Required if existingCaSecret is set.                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| webhook.ssl.ca.existingCaConfigMap                 | Provide the name of an existing ConfigMap that contains the CA required                                                                                                                                                                                                                                                                                                                                                                                       | <code></code>                                                                                                                                                                                      |
| webhook.ssl.ca.existingCaConfigMapKeyName          | Provide the filename that is defined inside the existing ConfigMap.  Required if existingCaConfigMap is set.                                                                                                                                                                                                                                                                                                                                                  | <code></code>                                                                                                                                                                                      |
| webhook.customEntryPoint                           | The custom entrypoint for the webhook <br/>Remember to provide the webhook valid arguments with `--tls_cert_file` and `--tls_private_key_file`. <br/>default: `/bin/webhook --tls_cert_file /cert/tls.crt --tls_private_key_file /cert/tls.key`                                                                                                                                                                                                               | <code>[]</code>                                                                                                                                                                                    |
| webhook.http.port                                  | The HTTP serve port where the requests will be served from.                                                                                                                                                                                                                                                                                                                                                                                                   | <code>5000</code>                                                                                                                                                                                  |
| scc.create                                         | Enable the creation of Security Context Constraints in Openshift.                                                                                                                                                                                                                                                                                                                                                                                             | <code>true</code>                                                                                                                                                                                  |
| scanner.enabled                                    | If you only want the Kubernetes Audit Log functionality then disable this option and it will disable the Admission Controller Scanning Policy functionality.                                                                                                                                                                                                                                                                                                  | <code>true</code>                                                                                                                                                                                  |
| scanner.name                                       | The service name for Scanner deployment.                                                                                                                                                                                                                                                                                                                                                                                                                      | <code>scanner</code>                                                                                                                                                                               |
| scanner.replicaCount                               | The amount of replicas for scanner.                                                                                                                                                                                                                                                                                                                                                                                                                           | <code>1</code>                                                                                                                                                                                     |
| scanner.image.registry                             | The Scanner image registry.                                                                                                                                                                                                                                                                                                                                                                                                                                   | <code>quay.io</code>                                                                                                                                                                               |
| scanner.image.repository                           | The Scanner image repository.                                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>sysdig/inline-scan-service</code>                                                                                                                                                            |
| scanner.image.pullPolicy                           | The PullPolicy for Scanner image.                                                                                                                                                                                                                                                                                                                                                                                                                             | <code></code>                                                                                                                                                                                      |
| scanner.image.tag                                  | The Scanner image tag.                                                                                                                                                                                                                                                                                                                                                                                                                                        | <code>0.0.16</code>                                                                                                                                                                                |
| scanner.image.digest                               | Specify the image digest value.  If set, this value is used instead of the tag value.                                                                                                                                                                                                                                                                                                                                                                         | <code></code>                                                                                                                                                                                      |
| scanner.labels                                     | Specifies additional labels. It applies to Scanner only.                                                                                                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                                                                                                                                                                    |
| scanner.service.port                               | Configure port for the webhook service.                                                                                                                                                                                                                                                                                                                                                                                                                       | <code>8080</code>                                                                                                                                                                                  |
| scanner.authWithSecureToken                        | Authenticate with Secure token.                                                                                                                                                                                                                                                                                                                                                                                                                               | <code>false</code>                                                                                                                                                                                 |
| scanner.httpProxy                                  | The HTTP Proxy settings for Scanner. <br/>Set to `http(s)://proxyIp:proxyPort` if the connection to Sysdig Secure requires a proxy.                                                                                                                                                                                                                                                                                                                           | <code>""</code>                                                                                                                                                                                    |
| scanner.httpsProxy                                 | The HTTPS Proxy settings for Scanner. <br/>Set to `http(s)://proxyIp:proxyPort` if connection to Sysdig Secure requires a proxy.                                                                                                                                                                                                                                                                                                                              | <code>""</code>                                                                                                                                                                                    |
| scanner.noProxy                                    | Specifies the list of hosts, IPs, or IPs in CIDR format that should not go through the proxy. Sysdig includes "kubernetes" service and typical 10.0.0.0/8 services.                                                                                                                                                                                                                                                                                           | <code>kubernetes,10.0.0.0/8</code>                                                                                                                                                                 |
| scanner.podAnnotations                             | Specifies the Scanner pod annotations.                                                                                                                                                                                                                                                                                                                                                                                                                        | <code>{"prometheus.io/path":"/metrics","prometheus.io/port":"8080","prometheus.io/scrape":"true"}</code>                                                                                           |
| scanner.psp.create                                 | Specifies whether to create a psp policy and role / role-binding.                                                                                                                                                                                                                                                                                                                                                                                             | <code>false</code>                                                                                                                                                                                 |
| scanner.podSecurityContext                         | The PSPs for scanner                                                                                                                                                                                                                                                                                                                                                                                                                                          | <code>{}</code>                                                                                                                                                                                    |
| scanner.verifyRegistryTLS                          | Verify the TLS on image pull from registries.                                                                                                                                                                                                                                                                                                                                                                                                                 | <code>true</code>                                                                                                                                                                                  |
| scanner.dockerCfgSecretName                        | The Docker config secret. Use a provided secret containing a `.dockercfg` for registry authentication (i.e. Openshift internal registry).                                                                                                                                                                                                                                                                                                                     | <code>""</code>                                                                                                                                                                                    |
| scanner.securityContext                            | Configure securityContext for scanner.                                                                                                                                                                                                                                                                                                                                                                                                                        | <code>{"capabilities":{"drop":["ALL"]},"readOnlyRootFilesystem":true,"runAsNonRoot":true}</code>                                                                                                   |
| scanner.imagePullSecrets                           | The image pull secrets for Scanner.                                                                                                                                                                                                                                                                                                                                                                                                                           | <code>[]</code>                                                                                                                                                                                    |
| scanner.resources                                  | Specifies resource requests and limits for Scanner.                                                                                                                                                                                                                                                                                                                                                                                                           | <code>{}</code>                                                                                                                                                                                    |
| scanner.nodeSelector                               | Configure nodeSelector for scheduling for the Scanner.                                                                                                                                                                                                                                                                                                                                                                                                        | <code>{}</code>                                                                                                                                                                                    |
| scanner.priorityClassName                          | Specifies the priorityClassName configuration for the Scanner.                                                                                                                                                                                                                                                                                                                                                                                                | <code></code>                                                                                                                                                                                      |
| scanner.tolerations                                | Specifies the sheduling tolerations for the Scanner.                                                                                                                                                                                                                                                                                                                                                                                                          | <code>[]</code>                                                                                                                                                                                    |
| scanner.affinity                                   | Configure affinity rules for the Scanner.                                                                                                                                                                                                                                                                                                                                                                                                                     | <code>{}</code>                                                                                                                                                                                    |
| scanner.ssl.ca.cert                                | For outbound connections, such as Secure backend and  proxy. <br/>A PEM-encoded x509 certificate authority.                                                                                                                                                                                                                                                                                                                                                   | <code>""</code>                                                                                                                                                                                    |
| scanner.ssl.ca.certs                               | For outbound connections, for example, the Secure backend and proxy. A PEM-encoded x509 certificate.  This can also be a bundle with multiple certificates.                                                                                                                                                                                                                                                                                                   | <code>[]</code>                                                                                                                                                                                    |
| scanner.ssl.ca.keyName                             | A filename that is used when creating the secret. Required if cert is provided.                                                                                                                                                                                                                                                                                                                                                                               | <code></code>                                                                                                                                                                                      |
| scanner.ssl.ca.existingCaSecret                    | Provide the name of an existing Secret that contains the CA required                                                                                                                                                                                                                                                                                                                                                                                          | <code></code>                                                                                                                                                                                      |
| scanner.ssl.ca.existingCaSecretKeyName             | Provide the filename that is defined inside the existing Secret.  Required if existingCaSecret is set.                                                                                                                                                                                                                                                                                                                                                        | <code></code>                                                                                                                                                                                      |
| scanner.ssl.ca.existingCaConfigMap                 | Provide the name of an existing ConfigMap that contains the CA required                                                                                                                                                                                                                                                                                                                                                                                       | <code></code>                                                                                                                                                                                      |
| scanner.ssl.ca.existingCaConfigMapKeyName          | Provide the filename that is defined inside the existing ConfigMap.  Required if existingCaConfigMap is set.                                                                                                                                                                                                                                                                                                                                                  | <code></code>                                                                                                                                                                                      |
| scanner.customEntryPoint                           | Custom entrypoint for the scanner. <br/>Remember to provide the scanner valid arguments with `--server_port` and optionally `--auth_secure_token` <br/>default: `/inline-scan-service --server_port=8080`                                                                                                                                                                                                                                                     | <code>[]</code>                                                                                                                                                                                    |



## Examples
- [Default `values.yaml`](https://github.com/sysdiglabs/charts/blob/main/charts/admission-controller/values.yaml)
- Find some [examples of these values](https://github.com/sysdiglabs/charts/tree/main/charts/admission-controller/ci)


<!--
Q: Helm v2 usage
should work with minor changes
1. Removed the option "--create-namespace" since not supported in v2. I don't see particular problem in creating the namespace manually before the execution of the chart
2. Added "--name" since required by v2 to specify the chart name
3. Changed Chart.yaml apiVersion: from v2 to v1. It seems that the difference is only related to dependencies and types, and I didn't find any of those in the chart (by default chats are considered as apps)
-->
