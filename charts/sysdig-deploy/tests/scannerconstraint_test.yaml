suite: Testing cluster scanner and node analyzer should not be both enabled
templates:
  - templates/scannerconstraint.yaml
tests:
  - it: Should fail if cluster scanner and new engine are both enabled
    set:
      secure:
        vulnerabilityManagement:
          newEngineOnly: true
      nodeAnalyzer:
        enabled: true
        runtimeScanner:
          deploy: false
      clusterScanner:
        enabled: true
    asserts:
      - failedTemplate:
          errorMessage: "Cannot enable both the clusterScanner and runtimeScanner at the same time"
  - it: Should fail if cluster scanner and runtimeScanner are both enabled
    set:
      secure:
        vulnerabilityManagement:
          newEngineOnly: false
      nodeAnalyzer:
        enabled: true
        runtimeScanner:
          deploy: true
      clusterScanner:
        enabled: true
    asserts:
      - failedTemplate:
          errorMessage: "Cannot enable both the clusterScanner and runtimeScanner at the same time"
  - it: Should not fail if only cluster scanner is enabled
    set:
      secure:
        vulnerabilityManagement:
          newEngineOnly: false
      nodeAnalyzer:
        enabled: false
        runtimeScanner:
          deploy: false
      clusterScanner:
        enabled: true
    asserts:
      - hasDocuments:
          count: 0
  - it: Should not fail if only node analyzer is enabled
    set:
      secure:
        vulnerabilityManagement:
          newEngineOnly: false
      nodeAnalyzer:
        enabled: true
        runtimeScanner:
          deploy: true
      clusterScanner:
        enabled: false
    asserts:
      - hasDocuments:
          count: 0
