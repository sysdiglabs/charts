suite: PSP create test
templates:
  - templates/psp.yaml
  # For checksums
  - templates/configmap-benchmark-runner.yaml
  - templates/configmap-host-analyzer.yaml
  - templates/configmap-host-scanner.yaml
  - templates/configmap-image-analyzer.yaml
  - templates/configmap-kspm-analyzer.yaml
  - templates/secrets.yaml
  - templates/serviceaccount-node-analyzer.yaml
  - templates/runtimeScanner/runtime-scanner-configmap.yaml
tests:
  - it: Ensure PSP is created on k8s <1.25
    capabilities:
      majorVersion: 1
      minorVersion: 24
    set:
      psp:
        create: true
    asserts:
      - containsDocument:
          apiVersion: policy/v1beta1
          kind: PodSecurityPolicy

  - it: Ensure PSP is not created on k8s >=1.25
    capabilities:
      majorVersion: 1
      minorVersion: 25
    asserts:
      - hasDocuments:
          count: 0

  - it: Ensure PSP is created on k8s <1.25 with '+' character in minor version
    capabilities:
      majorVersion: 1
      minorVersion: "24+"
    set:
      psp:
        create: true
    asserts:
      - containsDocument:
          apiVersion: policy/v1beta1
          kind: PodSecurityPolicy

  - it: Ensure PSP is not created on k8s >=1.25 with '+' character in minor version
    capabilities:
      majorVersion: 1
      minorVersion: "25+"
    asserts:
      - hasDocuments:
          count: 0
